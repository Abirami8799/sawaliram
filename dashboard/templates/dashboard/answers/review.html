{% extends "dashboard/base.html" %}

{% load static %}
{% load render_linebreaks %}

{% block title %} Review Answer | Sawaliram {% endblock %}

{% block content %}

{% with question=answer.question_id %}
	<h1 class="question-text-heading">{{ question.question_text }}</h1>
	
	<div class="answer-question highlighted-meta-area">
	    {% if question.student_class %}
	        <span class="highlighted-meta">
	            <i class="fas fa-user-graduate"></i></i>
	            <span class="meta-value">
	                Grade {{ question.student_class }}
	            </span>
	        </span>
	    {% endif %}
	
	    {% if question.school %}
	        <span class="highlighted-meta">
	            <i class="fas fa-graduation-cap"></i>
	            <span class="meta-value">
	                {{ question.school }}
	                {% if question.curriculum_followed %}
	                    ({{ question.curriculum_followed }})
	                {% endif %}
	            </span>
	        </span>
	    {% endif %}
	
	    {% if question.area or question.state %}
	        <span class="highlighted-meta">
	            <i class="fas fa-map-marker-alt"></i>
	            <span class="meta-value">
	                {% if question.area %}
	                    {{ question.area.rstrip }} {% if question.state %}, {{ question.state }} {% endif %}
	                {% elif question.state %}
	                    {{ question.state }}
	                {% endif %}
	            </span>    
	        </span>
	    {% endif %}
	    <span class="highlighted-meta">
			<i class="fas fa-user"></i>
			<span class="meta-value">Answered by <a href="#">{{ answer.answered_by.get_full_name }}</a></span>
	    </span>
	</div>
	
	<div id="answer">{{ answer.answer_text|safe }}</div>
	
	<div class="comment-thread">
		<h2>Comments</h2>
		<hr />
		{% for comment in comments %}
		    {% if comment.author == request.user %}
            <form action="{% url 'dashboard:delete-answer-comment' answer.id comment.id %}" method="GET">
            {% else %}
            <div>
            {% endif %}
				<p>
                    <b>{{ comment.author.get_full_name }}</b>
                    at {{ comment.created_on }}
                    {% if comment.author == request.user %}(<button type="submit" class="inline-button">delete</button>){% endif %}
                </p>
				{{ comment.text|escape|render_linebreaks|safe }}
			{% if comment.author == request.user %}
            </form>
            {% else %}
            </div>
            {% endif %}
			<hr />
		{% endfor %}
	    
	    <form action="{% url 'dashboard:submit-answer-comment' answer.id %}" id="comment-form" class="rich-text-form comment-form" method="POST">
		    {% csrf_token %}
		    <textarea name="comment-text" value=""></textarea>
		    <button type="submit" class="btn btn-block grey-button">Add Comment</button>
		</form>
	</div>
	</form>
	{% if request.user != answer.answered_by %}
		<form action="{% url 'dashboard:submit-answer-approval' answer.id %}" method="POST">
            {% csrf_token %}
			<button type="submit" class="btn btn-block green-button">Accept Answer</button>
	    </form>
	{% endif %}
{% endwith %}

{% endblock %}
